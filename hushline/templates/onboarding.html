{% extends "base.html" %}

{% block title %}Guide Me{% endblock %}
{% block body_class %}onboarding-body{% endblock %}
{% block main_class %}onboarding-main{% endblock %}

{% block content %}
  <div class="onboarding-wizard">

    <img
      class="onboarding"
      src="{{ url_for('static', filename='img/onboarding.png') }}"
      alt="Onboarding Logo"
    />
    <h2>Let's set up your account</h2>

    {% if step == "profile" %}
      <p class="meta">Step 1 of 4</p>
      <h3>First, tell us about yourself</h3>
      <p>What should we call you? Make it the same as what your audience is familiar with. Then, add a short bio to let whistleblowers know who you are and how you can help.</p>
      <form method="POST" class="formBody">
        {{ profile_form.hidden_tag() }}
        <input type="hidden" name="step" value="profile" />

        {{ profile_form.display_name.label }}
        {{ profile_form.display_name(id="display_name") }}
        {% for error in profile_form.display_name.errors %}
          <span class="error">{{ error }}</span>
        {% endfor %}

        <div class="label-with-wordcount">
          {{ profile_form.bio.label }}
          <span class="meta"><span class="bio-count">0</span>/250</span>
        </div>
        {{ profile_form.bio(id="bio", rows="4", maxlength="250") }}
        {% for error in profile_form.bio.errors %}
          <span class="error">{{ error }}</span>
        {% endfor %}

        <button class="contBtn" type="submit">Continue</button>
      </form>
      <form class="formBody skipForm firstSkip" method="POST" action="{{ url_for('onboarding_skip') }}">
        {{ skip_form.hidden_tag() }}
        <button type="submit" class="onboarding-skip">Skip setup for now</button>
      </form>
    {% elif step == "encryption" %}
      <p class="meta">Step 2 of 4</p>
      <h3>Now, let's set up encryption</h3>
      <p>We'll add your public encryption key so messages are secured and only you can read them. Proton Mail users can import their key below. If you need a Proton account, <a href="https://account.proton.me/signup?plan=free" target="_blank" rel="noopener noreferrer">sign up here</a>. Other users can paste their public PGP key manually. <a href="https://hushline.app/library/docs/getting-started/account-setup#option-21-use-with-proton-mail" target="_blank" rel="noopener noreferrer">Need more help?</a></p>
      <form method="POST" class="formBody">
        <label for="searchInput">Proton Email Search</label>
        {{ pgp_proton_form.hidden_tag() }}
        <input type="hidden" name="step" value="encryption" />
        <input type="hidden" name="method" value="proton" />
        <div class="search-box">
          <span id="searchIcon" aria-hidden="true">
            <img
              class="searchIcon"
              src="{{ url_for('static', filename='img/icon-search.png') }}"
              alt=""
            />
          </span>
          <input id="searchInput" type="email" name="email" placeholder="Search Proton email..." required="">
        </div>
        {% for error in pgp_proton_form.email.errors %}
          <span class="error">{{ error }}</span>
        {% endfor %}
        <button type="submit">Search Proton</button>
      </form>

      <form method="POST" class="formBody">
        {{ pgp_key_form.hidden_tag() }}
        <input type="hidden" name="step" value="encryption" />
        <input type="hidden" name="method" value="manual" />
        {{ pgp_key_form.pgp_key.label }}
        {{ pgp_key_form.pgp_key }}
        {% for error in pgp_key_form.pgp_key.errors %}
          <span class="error">{{ error }}</span>
        {% endfor %}
        <button class="contBtn" type="submit">Continue</button>
      </form>

      <a class="meta secondBack backBtn" href="{{ url_for('onboarding', step='profile') }}">Back</a>
      <form class="formBody skipForm" method="POST" action="{{ url_for('onboarding_skip') }}">
        {{ skip_form.hidden_tag() }}
        <button type="submit" class="onboarding-skip">Skip setup for now</button>
      </form>
    {% elif step == "notifications" %}
      <p class="meta">Step 3 of 4</p>
      <h3>Where should we send new tips?</h3>
      <p>
        Hush Line works best when tips are delivered to your email. If you imported a Proton Mail key on the previous step, use the same address here, and tips will automatically decrypt when they arrive in your inbox!
      </p>
      <form method="POST" class="formBody">
        {{ notifications_form.hidden_tag() }}
        <input type="hidden" name="step" value="notifications" />
        {{ notifications_form.email_address.label }}
        {{ notifications_form.email_address }}
        {% for error in notifications_form.email_address.errors %}
          <span class="error">{{ error }}</span>
        {% endfor %}
        <button class="finishBtn" type="submit">Continue</button>
      </form>
      <a class="meta backBtn thirdBack" href="{{ url_for('onboarding', step='encryption') }}">Back</a>
      <form class="formBody lastSkip skipForm" method="POST" action="{{ url_for('onboarding_skip') }}">
        {{ skip_form.hidden_tag() }}
        <button type="submit" class="onboarding-skip">Skip setup for now</button>
      </form>
    {% elif step == "directory" %}
      <p class="meta">Step 4 of 4</p>
      <h3>Finally, join the User Directory!</h3>
      <p>
        The User Directory helps whistleblowers discover your tip line. You can change this anytime in your profile settings.
      </p>
      <form method="POST" class="formBody">
        {{ directory_form.hidden_tag() }}
        <input type="hidden" name="step" value="directory" />
        <div class="checkbox-group toggle-ui">
          {{ directory_form.show_in_directory() }}
          <label for="show_in_directory" class="toggle-label">
            Show on public directory
            <div class="toggle">
              <div class="toggle__ball"></div>
            </div>
          </label>
        </div>
        {% for error in directory_form.show_in_directory.errors %}
          <span class="error">{{ error }}</span>
        {% endfor %}
        <button class="finishBtn" type="submit">Finish</button>
      </form>
      <a class="meta backBtn" href="{{ url_for('onboarding', step='notifications') }}">Back</a>
      <form class="formBody lastSkip skipForm" method="POST" action="{{ url_for('onboarding_skip') }}">
        {{ skip_form.hidden_tag() }}
        <button type="submit" class="onboarding-skip">Skip setup for now</button>
      </form>
    {% else %}
      <a href="{{ url_for('onboarding', step='profile') }}">Start the guide</a>
      <form class="formBody skipForm" method="POST" action="{{ url_for('onboarding_skip') }}">
        {{ skip_form.hidden_tag() }}
        <button type="submit" class="onboarding-skip">Skip setup for now</button>
      </form>
    {% endif %}
    <div class="onboarding-footer"></div>
  </div>
{% endblock %}

{% block scripts %}
  <script defer src="{{ url_for('static', filename='js/onboarding.js') }}"></script>
{% endblock %}
