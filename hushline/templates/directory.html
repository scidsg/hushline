{% extends "base.html" %}

{% block title %}Directory{% endblock %}
{% block body_class %}directory-page{% endblock %}

{% block content %}
  <h2 id="directory-title">User Directory</h2>

  {% if intro_text %}
    {{ intro_text | markdown }}
  {% endif %}

  {% if directory_verified_tab_enabled %}
    <div id="directory-top-anchor" class="directory-top-anchor" aria-hidden="true"></div>
    <div class="directory-tabs" id="directory-tabs">
      <ul class="tab-list" role="tablist">
        <li role="presentation">
          <button
            type="button"
            class="tab active"
            data-tab="verified"
            role="tab"
            aria-selected="true"
            aria-controls="verified"
            id="verified-tab"
          >
            Verified
          </button>
        </li>
        <li role="presentation">
          <button
            type="button"
            class="tab"
            data-tab="all"
            role="tab"
            aria-selected="false"
            aria-controls="all"
            id="all-tab"
          >
            All
          </button>
        </li>
      </ul>
      <div class="tab-top-item" role="presentation">
        <a class="tab-top-link" href="#directory-top-anchor" aria-label="Back to top">
          Top
        </a>
      </div>
    </div>
  {% endif %}

  <div class="directory-search">
    <div class="search-box">
      <label id="searchIcon" for="searchInput">
        <img
          src="{{ url_for('static', filename='img/icon-search.png') }}"
          alt=""
        />
      </label>
      <input
        type="text"
        id="searchInput"
        placeholder="Search users..."
        aria-label="Search users"
      />
      <button
        id="clearIcon"
        type="button"
        aria-label="Clear search field"
        style="cursor: pointer; background: none; border: none; padding: 0"
      >
        <img
          src="{{ url_for('static', filename='img/icon-clear.png') }}"
          alt=""
        />
      </button>
    </div>
  </div>

  {% if directory_verified_tab_enabled %}
    <div
      id="verified"
      class="tab-content active"
      role="tabpanel"
      aria-labelledby="verified-tab"
    >

    {% if not logged_in %}
      <p class="meta dirMeta">
        â­ï¸ Verified account owners have verified their identities with a member of our staff.
        <a
          href="https://hushline.app/library/docs/using-your-tip-line/account-verification"
          target="_blank"
          rel="noopener noreferrer"
          >Learn more about verification</a>.
      </p>
    {% endif %}

    <div class="user-list">
      {% for username in verified_pgp_usernames %}
        <article class="user">
          <h3>{{ username.display_name or username.username }}</h3>
          {% if username.username %}
            <p class="meta">@{{ username.username }}</p>
          {% endif %}
          {% if username.is_verified or username.user.is_admin %}
            <div class="badgeContainer">
              {% if username.user.is_admin %}
                <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
              {% endif %}
              {% if username.is_verified %}
                <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
              {% endif %}
            </div>
          {% endif %}
          {% if username.bio %}
            <p class="bio">{{ username.bio }}</p>
          {% endif %}
          <div class="user-actions">
            <a
              href="{{ url_for('profile', username=username.username) }}"
              aria-label="{{ (username.display_name or username.username) }}'s profile"
              >View Profile</a
            >
          </div>
        </article>
      {% endfor %}
    </div>
    {% if verified_info_usernames %}
      <p class="label">ğŸ“‡ Info-Only Accounts</p>
      <div class="user-list">
        {% for username in verified_info_usernames %}
        <article class="user">
          <h3>{{ username.display_name or username.username }}</h3>
          {% if username.username %}
            <p class="meta">@{{ username.username }}</p>
          {% endif %}
          {% if username.is_verified or username.user.is_admin %}
            <div class="badgeContainer">
              {% if username.user.is_admin %}
                <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
              {% endif %}
              {% if username.is_verified %}
                <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
              {% endif %}
            </div>
          {% endif %}
          {% if username.bio %}
            <p class="bio">{{ username.bio }}</p>
          {% endif %}
          <div class="user-actions">
            <a
              href="{{ url_for('profile', username=username.username) }}"
              aria-label="{{ (username.display_name or username.username) }}'s profile"
              >View Profile</a
            >
          </div>
        </article>
        {% endfor %}
      </div>
    {% endif %}
  </div>
  {% endif %}

  <div
    id="all"
    class="tab-content {% if not directory_verified_tab_enabled %}active{% endif %}"
    {% if directory_verified_tab_enabled %}
      role="tabpanel"
      aria-labelledby="all-tab"
    {% else %}
      role="region"
      aria-labelledby="directory-title"
    {% endif %}
  >
    <div class="user-list">
      {% for username in pgp_usernames %}
          <article class="user">
            <h3>{{ username.display_name or username.username }}</h3>
            {% if username.username %}
              <p class="meta">@{{ username.username }}</p>
            {% endif %}
            {% if username.is_verified or username.user.is_admin %}
              <div class="badgeContainer">
                {% if username.user.is_admin %}
                  <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
                {% endif %}
                {% if username.is_verified %}
                  <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
                {% endif %}
              </div>
            {% endif %}
            {% if username.bio %}
              <p class="bio">{{ username.bio }}</p>
            {% endif %}
            <div class="user-actions">
              <a
                href="{{ url_for('profile', username=username.username) }}"
                aria-label="{{ (username.display_name or username.username) }}'s profile"
                >View Profile</a
              >
            </div>
          </article>
      {% endfor %}
    </div>
    {% if info_usernames %}
      <p class="label">ğŸ“‡ Info-Only Accounts</p>
      <div class="user-list">
        {% for username in info_usernames %}
        <article class="user">
          <h3>{{ username.display_name or username.username }}</h3>
          {% if username.username %}
            <p class="meta">@{{ username.username }}</p>
          {% endif %}
          {% if username.is_verified or username.user.is_admin %}
            <div class="badgeContainer">
              {% if username.user.is_admin %}
                <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
              {% endif %}
              {% if username.is_verified %}
                <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
              {% endif %}
            </div>
          {% endif %}
          {% if username.bio %}
            <p class="bio">{{ username.bio }}</p>
          {% endif %}
          <div class="user-actions">
            <a
              href="{{ url_for('profile', username=username.username) }}"
              aria-label="{{ (username.display_name or username.username) }}'s profile"
              >View Profile</a
            >
          </div>
        </article>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block scripts %}
  <script defer src="{{ url_for('static', filename='js/user_search.js') }}"></script>
  {% if directory_verified_tab_enabled %}
    <script defer src="{{ url_for('static', filename='js/directory_verified.js') }}"></script>
  {% else %}
    <script defer src="{{ url_for('static', filename='js/directory.js') }}"></script>
  {% endif %}
{% endblock %}
