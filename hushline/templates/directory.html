{% extends "base.html" %}

{% block title %}Directory{% endblock %}
{% block body_class %}directory-page{% endblock %}

{% block content %}
  <h2 id="directory-title">User Directory</h2>

  {% if intro_text %}
    {{ intro_text | markdown }}
  {% endif %}

  {% if directory_verified_tab_enabled %}
    <div class="directory-tabs" id="directory-tabs">
      <ul class="tab-list" role="tablist">
        <li role="presentation">
          <button
            type="button"
            class="tab active"
            data-tab="verified"
            role="tab"
            aria-selected="true"
            aria-controls="verified"
            id="verified-tab"
          >
            Verified
          </button>
        </li>
        <li role="presentation">
          <button
            type="button"
            class="tab"
            data-tab="public-records"
            role="tab"
            aria-selected="false"
            aria-controls="public-records"
            id="public-records-tab"
          >
            Public Record Law Firms
          </button>
        </li>
        <li role="presentation">
          <button
            type="button"
            class="tab"
            data-tab="all"
            role="tab"
            aria-selected="false"
            aria-controls="all"
            id="all-tab"
          >
            All
          </button>
        </li>
      </ul>
    </div>
  {% endif %}

  <div class="directory-search">
    <div class="search-box">
      <label id="searchIcon" for="searchInput">
        <img
          src="{{ url_for('static', filename='img/icon-search.png') }}"
          alt=""
        />
      </label>
      <input
        type="text"
        id="searchInput"
        placeholder="Search directory..."
        aria-label="Search directory"
      />
      <button
        id="clearIcon"
        type="button"
        aria-label="Clear search field"
        style="cursor: pointer; background: none; border: none; padding: 0"
      >
        <img
          src="{{ url_for('static', filename='img/icon-clear.png') }}"
          alt=""
        />
      </button>
    </div>
    <p
      id="directory-search-status"
      class="visually-hidden"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></p>
  </div>

  {% if directory_verified_tab_enabled %}
    <div
      id="verified"
      class="tab-content active"
      role="tabpanel"
      aria-labelledby="verified-tab"
    >
      {% if not logged_in %}
        <p class="meta dirMeta">
          â­ï¸ Verified account owners have verified their identities with a member of our staff.
          <a
            href="https://hushline.app/library/docs/using-your-tip-line/account-verification"
            target="_blank"
            rel="noopener noreferrer"
            >Learn more about verification</a
          >.
        </p>
      {% endif %}

      <div class="user-list">
        {% for username in verified_pgp_usernames %}
          <article class="user">
            <h3>{{ username.display_name or username.username }}</h3>
            {% if username.username %}
              <p class="meta">@{{ username.username }}</p>
            {% endif %}
            {% if username.is_verified or username.user.is_admin %}
              <div class="badgeContainer">
                {% if username.user.is_admin %}
                  <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
                {% endif %}
                {% if username.is_verified %}
                  <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
                {% endif %}
              </div>
            {% endif %}
            {% if username.bio %}
              <p class="bio">{{ username.bio }}</p>
            {% endif %}
            <div class="user-actions">
              <a
                href="{{ url_for('profile', username=username.username) }}"
                aria-label="{{ (username.display_name or username.username) }}'s profile"
                >View Profile</a
              >
            </div>
          </article>
        {% endfor %}
      </div>
      {% if verified_info_usernames %}
        <p class="label">ğŸ“‡ Info-Only Accounts</p>
        <div class="user-list">
          {% for username in verified_info_usernames %}
            <article class="user">
              <h3>{{ username.display_name or username.username }}</h3>
              {% if username.username %}
                <p class="meta">@{{ username.username }}</p>
              {% endif %}
              {% if username.is_verified or username.user.is_admin %}
                <div class="badgeContainer">
                  {% if username.user.is_admin %}
                    <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
                  {% endif %}
                  {% if username.is_verified %}
                    <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
                  {% endif %}
                </div>
              {% endif %}
              {% if username.bio %}
                <p class="bio">{{ username.bio }}</p>
              {% endif %}
              <div class="user-actions">
                <a
                  href="{{ url_for('profile', username=username.username) }}"
                  aria-label="{{ (username.display_name or username.username) }}'s profile"
                  >View Profile</a
                >
              </div>
            </article>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% endif %}

  {% if directory_verified_tab_enabled %}
    <div
      id="public-records"
      class="tab-content"
      role="tabpanel"
      aria-labelledby="public-records-tab"
    >
      <p class="meta dirMeta">
        ğŸ¤– These are automated, public-record listings.
        <a href="/to/admin">Message Hush Line Admin</a> for corrections.
      </p>

      <div class="user-list">
        {% for listing in public_record_listings %}
          <article class="user">
            <h3>{{ listing.name }}</h3>
            <div class="badgeContainer">
              <span class="badge" role="img" aria-label="Public record listing">ğŸ›ï¸ Public Record</span>
              <span class="badge" role="img" aria-label="Automated listing">ğŸ¤– Automated</span>
            </div>
            <p class="bio">{{ listing.description }}</p>
            <div class="user-actions">
              <a
                href="{{ url_for('public_record_listing', slug=listing.slug) }}"
                aria-label="View read-only listing for {{ listing.name }}"
                >View Listing</a
              >
            </div>
          </article>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <div
    id="all"
    class="tab-content {% if not directory_verified_tab_enabled %}active{% endif %}"
    role="tabpanel"
    {% if directory_verified_tab_enabled %}aria-labelledby="all-tab"{% endif %}
  >
    <div class="user-list">
      {% for username in pgp_usernames %}
        <article class="user">
          <h3>{{ username.display_name or username.username }}</h3>
          {% if username.username %}
            <p class="meta">@{{ username.username }}</p>
          {% endif %}
          {% if username.is_verified or username.user.is_admin %}
            <div class="badgeContainer">
              {% if username.user.is_admin %}
                <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
              {% endif %}
              {% if username.is_verified %}
                <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
              {% endif %}
            </div>
          {% endif %}
          {% if username.bio %}
            <p class="bio">{{ username.bio }}</p>
          {% endif %}
          <div class="user-actions">
            <a
              href="{{ url_for('profile', username=username.username) }}"
              aria-label="{{ (username.display_name or username.username) }}'s profile"
              >View Profile</a
            >
          </div>
        </article>
      {% endfor %}
    </div>
    {% if info_usernames %}
      <p class="label">ğŸ“‡ Info-Only Accounts</p>
      <div class="user-list">
        {% for username in info_usernames %}
          <article class="user">
            <h3>{{ username.display_name or username.username }}</h3>
            {% if username.username %}
              <p class="meta">@{{ username.username }}</p>
            {% endif %}
            {% if username.is_verified or username.user.is_admin %}
              <div class="badgeContainer">
                {% if username.user.is_admin %}
                  <span class="badge" role="img" aria-label="Administrator account">âš™ï¸ Admin</span>
                {% endif %}
                {% if username.is_verified %}
                  <span class="badge" role="img" aria-label="Verified account">â­ï¸ Verified</span>
                {% endif %}
              </div>
            {% endif %}
            {% if username.bio %}
              <p class="bio">{{ username.bio }}</p>
            {% endif %}
            <div class="user-actions">
              <a
                href="{{ url_for('profile', username=username.username) }}"
                aria-label="{{ (username.display_name or username.username) }}'s profile"
                >View Profile</a
              >
            </div>
          </article>
        {% endfor %}
      </div>
    {% endif %}

    {% if directory_verified_tab_enabled %}
      <p class="label">ğŸ›ï¸ Public Record Law Firms</p>
      <div class="user-list">
        {% for listing in public_record_listings %}
          <article class="user">
            <h3>{{ listing.name }}</h3>
            <div class="badgeContainer">
              <span class="badge" role="img" aria-label="Public record listing">ğŸ›ï¸ Public Record</span>
              <span class="badge" role="img" aria-label="Automated listing">ğŸ¤– Automated</span>
            </div>
            <p class="bio">{{ listing.description }}</p>
            <div class="user-actions">
              <a
                href="{{ url_for('public_record_listing', slug=listing.slug) }}"
                aria-label="View read-only listing for {{ listing.name }}"
                >View Listing</a
              >
            </div>
          </article>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block scripts %}
  <script defer src="{{ url_for('static', filename='js/user_search.js') }}"></script>
  <script defer src="{{ url_for('static', filename='js/directory_verified.js') }}"></script>
{% endblock %}
