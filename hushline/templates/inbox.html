{% extends "base.html" %}
{% block title %}Inbox{% endblock %}

{% block content %}
    {% if messages %}
        <h2>Inbox for {{ user.display_name or user.primary_username }}</h2>
        {% for message in messages %}
            <div class="message{% if 'BEGIN PGP MESSAGE' in message.content %} encrypted{% endif %}" data-encrypted-content="{{ message.content | safe }}">
                {% if not is_secondary %}
                    {% if message.secondary_user_id %}
                        {% set sender_info = secondary_usernames[message.secondary_user_id] %}
                        <p class="message-label">ðŸ“¥ {{ sender_info.display_name or sender_info.username }}</p>
                    {% elif secondary_usernames|length > 0 %}
                        <p class="message-label">ðŸ“¥ {{ user.display_name or user.primary_username }}</p>
                    {% endif %}
                {% endif %}
                <p class="decrypted-content">{{ message.content }}</p>
                <div class="mailvelope-decryption-container" id="decryption-container-{{ message.id }}"></div>
                <form action="{{ url_for('delete_message', message_id=message.id) }}" method="POST">
                    <button type="submit" class="btn btn-danger" id="deleteMessageButton">Delete</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <div class="emptyState">
            <img class="empty" src="{{ url_for('static', filename='img/empty.png') }}" alt="Empty Inbox">
            <h1>Nothing to see here...</h1>
            <p>No messages yet.</p>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/mailvelope.js') }}"></script>
<script src="{{ url_for('static', filename='js/inbox.js') }}"></script>
{% endblock %}
